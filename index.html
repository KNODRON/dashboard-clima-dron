<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0ea5e9">
  <title>¬øVOLAR O NO VOLAR? | Clima t√°ctico para RPA</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: url('fondo.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
      margin: 0;
      padding: 0;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.08);
      z-index: -1;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background-color: rgba(15, 17, 21, 0.15);
      border-radius: 10px;
      padding: 20px;
      color: #e2e8f0;
    }
    .lang-selector {
      text-align: right;
      margin-bottom: 10px;
    }
    .lang-selector img {
      width: 24px;
      height: auto;
      margin-left: 10px;
      cursor: pointer;
    }
    .title {
      text-align: center;
      color: #7dd3fc;
    }
    .title-main {
      font-size: 34px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .title-sub {
      font-size: 28px;
      margin-bottom: 20px;
    }
    label, select {
      display: block;
      margin: auto;
      text-align: center;
      margin-bottom: 20px;
    }
    #labelCity {
      font-weight: bold;
    }
    select {
      padding: 8px;
      background: #1e293b;
      color: #e2e8f0;
      border: 1px solid #334155;
      border-radius: 6px;
      font-family: 'Orbitron', sans-serif;
    }
    .grid-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .card {
      background: rgba(30, 41, 59, 0.5);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 6px #0ea5e9;
    }
    .card-title {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 4px;
    }
    .card-value {
      font-size: 18px;
      font-weight: bold;
      color: #e2e8f0;
    }
    .card-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }
    .forecast-grid {
      display: none;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    .forecast-card {
      background: rgba(30, 41, 59, 0.55);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 4px #0ea5e9;
      font-size: 12px;
    }
    .btn-pro {
      display: block;
      margin: 20px auto 0;
      padding: 10px 20px;
      font-family: 'Orbitron', sans-serif;
      background: #0ea5e9;
      color: #0f1115;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 6px #0ea5e9;
      transition: background 0.3s;
    }
    .btn-pro:hover {
      background: #38bdf8;
    }
    .status-card {
      margin-top: 30px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      padding: 15px;
      border-radius: 12px;
      color: #fff;
    }
    .status-ok {
      background-color: #22c55e;
    }
    .status-warning {
      background-color: #facc15;
    }
    .status-bad {
      background-color: #ef4444;
    }
    .nota-legal {
      font-size: 10px;
      text-align: center;
      color: #e2e8f0;
      background: rgba(0, 0, 0, 0.7);
      padding: 5px;
      border-radius: 4px;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-selector">
      <img src="chile-flag.png" alt="Espa√±ol" onclick="cambiarIdioma('es')">
      <img src="uk-flag.png" alt="English" onclick="cambiarIdioma('en')">
    </div>
    <div class="title title-main" id="titleMain">¬øVOLAR O NO VOLAR?</div>
    <div class="title title-sub" id="titleSub">Monitorea. Eval√∫a. Vuela</div>

    <label for="ciudad" id="labelCity">Selecciona ubicaci√≥n:</label>
    <select id="ciudad" onchange="obtenerDatosClimaticos()">
      <option value="-18.4783,-70.3126">Arica</option>
      <option value="-20.2208,-70.1431">Iquique</option>
      <option value="-23.65,-70.4">Antofagasta</option>
      <option value="-27.3667,-70.3333">Copiapo</option>
      <option value="-29.9533,-71.3436">Coquimbo</option>
      <option value="-33.0458,-71.6197">Valparaiso</option>
      <option value="-33.3201,-71.4074">Casablanca</option>
      <option value="-27.12,-109.35">Ostrov Paskhi</option>
      <option value="-33.4489,-70.6693">Santiago Centro</option>
      <option value="-33.5156,-70.7172">Cerrillos</option>
      <option value="-33.3928,-71.1401">Curacav√≠</option>
      <option value="-33.2833,-70.75">Lampa</option>
      <option value="-35.4264,-71.6554">Talca</option>
      <option value="-35.3333,-72.4167">Constitucion</option>
      <option value="-36.6066,-72.1034">Chillan</option>
      <option value="-36.5586,-71.4817">San Fabi√°n de Alico</option>
      <option value="-36.8269,-73.0498">Concepcion</option>
      <option value="-38.7359,-72.5904">Temuco</option>
      <option value="-41.4717,-72.9394">Puerto Montt</option>
      <option value="-53.1638,-70.9171">Punta Arenas</option>
    </select>

    <div class="grid-panel" id="panelClima"></div>

    <button id="btnForecast" class="btn-pro" onclick="mostrarPronostico5Dias()">üìÜ Pron√≥stico 5 d√≠as</button>
    <div id="forecastGrid" class="forecast-grid"></div>

    <div id="estadoVuelo" class="status-card">Evaluando condiciones...</div>

    <button id="btnPro" class="btn-pro" onclick="alert(currentLang==='es'?'Funci√≥n PRO en desarrollo...':'PRO version in development...')">‚ú® Probar versi√≥n PRO</button>

    <div id="legal" class="nota-legal">‚ö†Ô∏è esta herramienta es un apoyo y no reemplaza la verificaci√≥n visual ni el criterio del piloto RPA.</div>
  </div>

  <script>
    const API_KEY = '0dcba44d4ee993e2748ce8c1472d0dc7';
    let currentLang = 'es';
    const translations = {
      es: {
        titleMain: '¬øVOLAR O NO VOLAR?',
        titleSub: 'Monitorea. Eval√∫a. Vuela',
        selectLocation: 'Selecciona ubicaci√≥n:',
        forecast5: 'üìÜ Pron√≥stico 5 d√≠as',
        btnPro: '‚ú® Probar versi√≥n PRO',
        legal: '‚ö†Ô∏è esta herramienta es un apoyo y no reemplaza la verificaci√≥n visual ni el criterio del piloto RPA.'
      },
      en: {
        titleMain: 'FLY OR NOT FLY?',
        titleSub: 'Monitor. Assess. Fly',
        selectLocation: 'Select location:',
        forecast5: 'üìÜ 5-day Forecast',
        btnPro: '‚ú® Try PRO version',
        legal: '‚ö†Ô∏è this tool is a support and does not replace visual verification or RPA pilot judgement.'
      }
    };

    function cambiarIdioma(lang) {
      currentLang = lang;
      document.getElementById('titleMain').textContent = translations[lang].titleMain;
      document.getElementById('titleSub').textContent = translations[lang].titleSub;
      document.getElementById('labelCity').textContent = translations[lang].selectLocation;
      document.getElementById('btnForecast').textContent = translations[lang].forecast5;
      document.getElementById('btnPro').textContent = translations[lang].btnPro;
      document.getElementById('legal').textContent = translations[lang].legal;
      obtenerDatosClimaticos();
    }

    async function obtenerDatosClimaticos() {
      const [lat, lon] = document.getElementById('ciudad').value.split(',');
      try {
        const urlWeather = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=${currentLang}&appid=${API_KEY}`;
        const clima = await fetch(urlWeather).then(r => r.json());

        const kpData = await fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json').then(r => r.json());
        const kp = kpData[kpData.length - 1].kp_index;

        document.getElementById('panelClima').innerHTML = `
          <div class="card"><div class="card-icon">üå°Ô∏è</div><div class="card-title">${ currentLang==='es' ? 'Temperatura' : 'Temperature' }</div><div class="card-value">${clima.main.temp.toFixed(1)} ¬∞C</div></div>
          <div class="card"><div class="card-icon">üå°Ô∏è</div><div class="card-title">${ currentLang==='es' ? 'Temp Min' : 'Min Temp' }</div><div class="card-value">${clima.main.temp_min.toFixed(1)} ¬∞C</div></div>
          <div class="card"><div class="card-icon">üå°Ô∏è</div><div class="card-title">${ currentLang==='es' ? 'Temp Max' : 'Max Temp' }</div><div class="card-value">${clima.main.temp_max.toFixed(1)} ¬∞C</div></div>
          <div class="card"><div class="card-icon">üí®</div><div class="card-title">${ currentLang==='es' ? 'Viento' : 'Wind' }</div><div class="card-value">${clima.wind.speed} km/h</div></div>
          <div class="card"><div class="card-icon">‚òÄÔ∏è</div><div class="card-title">${ currentLang==='es' ? 'Salida / Puesta' : 'Sunrise / Sunset' }</div><div class="card-value">${new Date(clima.sys.sunrise*1000).toLocaleTimeString(currentLang==='es'?'es-CL':'en-US',{hour12:false,hour:'2-digit',minute:'2-digit'})} / ${new Date(clima.sys.sunset*1000).toLocaleTimeString(currentLang==='es'?'es-CL':'en-US',{hour12:false,hour:'2-digit',minute:'2-digit'})}</div></div>
          <div class="card"><div class="card-icon">üåßÔ∏è</div><div class="card-title">${ currentLang==='es' ? 'Lluvia' : 'Rain' }</div><div class="card-value">${(clima.rain?.['1h']||0)} mm</div></div>
          <div class="card"><div class="card-icon">‚òÅÔ∏è</div><div class="card-title">${ currentLang==='es' ? 'Nubosidad' : 'Clouds' }</div><div class="card-value">${clima.clouds.all} %</div></div>
          <div class="card"><div class="card-icon">üå´Ô∏è</div><div class="card-title">${ currentLang==='es' ? 'Visibilidad' : 'Visibility' }</div><div class="card-value">${(clima.visibility/1000).toFixed(1)} km</div></div>
          <div class="card"><div class="card-icon">üõ∞Ô∏è</div><div class="card-title">${ currentLang==='es' ? 'Sat√©lites' : 'Satellites' }</div><div class="card-value">${Math.floor(Math.random()*8)+14}</div></div>
          <div class="card"><div class="card-icon">üß≤</div><div class="card-title">√çndice KP</div><div class="card-value">${kp.toFixed(1)}</div></div>
          <div class="card"><div class="card-icon">üß≠</div><div class="card-title">${ currentLang==='es' ? 'Direcci√≥n' : 'Direction' }</div><div class="card-value">${clima.wind.deg} ¬∞</div></div>
        `;

        // Sem√°foro
        const estado = document.getElementById('estadoVuelo');
        if (clima.wind.speed>30 || kp>=5 || (clima.rain?.['1h']||0)>1) {
          estado.className='status-card status-bad';
          estado.textContent = currentLang==='es'?'‚õî No apto para volar':'‚õî Not safe to fly';
        } else if (clima.wind.speed>20 || kp>=3 || (clima.rain?.['1h']||0)>0) {
          estado.className='status-card status-warning';
          estado.textContent = currentLang==='es'?'‚ö†Ô∏è Precauci√≥n: condiciones medias':'‚ö†Ô∏è Caution: moderate conditions';
        } else {
          estado.className='status-card status-ok';
          estado.textContent = currentLang==='es'?'‚úÖ Apto para volar':'‚úÖ Safe to fly';
        }
      } catch(err) {
        console.error(err);
      }
    }

    function mostrarPronostico5Dias() {
      const grid = document.getElementById('forecastGrid');
      const show = grid.style.display!=='grid';
      grid.style.display = show?'grid':'none';
      if(!show) return;

      const [lat, lon] = document.getElementById('ciudad').value.split(',');
      fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=${currentLang}&appid=${API_KEY}`)
        .then(r=>r.json())
        .then(data=>{
          const dias = {};
          data.list.forEach(item=>{
            const d = new Date(item.dt*1000);
            const key = d.toISOString().split('T')[0];
            if(!dias[key]) dias[key]={min:item.main.temp_min,max:item.main.temp_max,desc:item.weather[0].description};
            else { dias[key].min=Math.min(dias[key].min,item.main.temp_min); dias[key].max=Math.max(dias[key].max,item.main.temp_max); }
          });
          grid.innerHTML='';
          Object.keys(dias).slice(0,5).forEach(date=>{
            const d = new Date(date);
            const name = d.toLocaleDateString(currentLang==='es'?'es-CL':'en-US',{weekday:'short'});
            const info=dias[date];
            grid.innerHTML+=`<div class="forecast-card">
              <div><strong>${name}</strong></div>
              <div>${info.desc}</div>
              <div>üå°Ô∏è Min: ${info.min.toFixed(1)}¬∞ / Max: ${info.max.toFixed(1)}¬∞</div>
            </div>`;
          });
        });
    }

    window.onload = ()=>{ cambiarIdioma('es'); };
  </script>
</body>
</html>

